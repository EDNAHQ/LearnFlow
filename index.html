<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/EDNA Logo.png">
    <title>LearnFlow - Personalized Learning Paths</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      /* Critical first-paint CSS to avoid UA defaults and font flashes */
      html, body { height: 100%; }
      body { margin: 0; background: #ffffff; color: #0b0c18; font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif; font-weight: 300; }
      #root, #portal-root { isolation: isolate; }
    </style>

    <!-- Primary Meta Tags -->
    <meta name="title" content="LearnFlow - Personalized Learning Paths">
    <meta name="description" content="Master any topic with personalized learning paths that adapt to your pace. Transform your knowledge with intelligent, adaptive education.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://learnflow.app/">
    <meta property="og:title" content="LearnFlow - Personalized Learning Paths">
    <meta property="og:description" content="Master any topic with personalized learning paths that adapt to your pace. Transform your knowledge with intelligent, adaptive education.">
    <meta property="og:image" content="https://learnflow.app/images/sam.mckay.edna_Network_of_nodes_connected_by_glowing_lines_ea_1fa62e10-cb69-40e5-bb59-618e8919caf8_1.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://learnflow.app/">
    <meta property="twitter:title" content="LearnFlow - Personalized Learning Paths">
    <meta property="twitter:description" content="Master any topic with personalized learning paths that adapt to your pace. Transform your knowledge with intelligent, adaptive education.">
    <meta property="twitter:image" content="https://learnflow.app/images/sam.mckay.edna_Network_of_nodes_connected_by_glowing_lines_ea_1fa62e10-cb69-40e5-bb59-618e8919caf8_1.png">

    <!-- Theme Color -->
    <meta name="theme-color" content="#6654f5">
</head>
<body>
    <div id="root"></div>
    <div id="portal-root"></div>

    <!-- SSO Loading Screen - Shows immediately when SSO parameters are detected -->
    <script>
      (function() {
        var params = new URLSearchParams(window.location.search);
        var sso = params.get('sso');
        var sig = params.get('sig');

        if (sso && sig) {
          // Immediately show loading screen before React loads
          var root = document.getElementById('root');
          if (root) {
            root.innerHTML = '<div id="sso-loading-screen" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background-color: white; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 999999;"><div style="animation: sso-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;"><img src="/EDNA Logo.png" alt="EDNA" style="width: 128px; height: 128px; object-fit: contain;" /></div></div>';

            // Add the keyframe animation
            var style = document.createElement('style');
            style.textContent = '@keyframes sso-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }';
            document.head.appendChild(style);
          }
        }
      })();
    </script>

    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Need Help badge next to the widget -->
    <button id="helpgenie-badge" type="button" aria-label="Need help?"
            style="position: fixed; bottom: 24px; right: 92px; z-index: 2147483000; background: #ffffff; color: #0b0c18; border: 1px solid #6654f5; border-radius: 9999px; padding: 8px 12px; font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; font-size: 14px; line-height: 1; box-shadow: 0 2px 8px rgba(102,84,245,0.18); display: inline-flex; align-items: center; gap: 6px; cursor: pointer; font-weight: 500;">
      Need help?
    </button>
    
    <!-- HelpGenie Widget -->
    <script>
      (function(w,d,s,o,f,js,fjs){
        w[o]=w[o]||function(){(w[o].q=w[o].q||[]).push(arguments)};
        w[o].q=w[o].q||[];
        js=d.createElement(s),fjs=d.getElementsByTagName(s)[0];
        js.id=o;js.src=f;js.async=1;fjs.parentNode.insertBefore(js,fjs);
      }(window,document,'script','hg','https://helpgenie.ai/widget.js'));
      
      hg('init', {
        agentUrl: 'learn-flow',
        position: 'bottom-right',
        primaryColor: '#ac5ca4',
        buttonColor: '#dfeaf4', // Customize button background color
        baseUrl: 'https://helpgenie.ai',
        agentName: 'Learn Flow',
        customAvatarUrl: 'https://vdskjkjxyeehklwxnhrf.supabase.co/storage/v1/object/public/genie-images/2ahqvn5-1759724943216.png'
      });
    </script>
    <!-- End HelpGenie Widget -->

    <!-- Open widget when clicking the Need Help badge -->
    <script>
      (function(){
        var badge = document.getElementById('helpgenie-badge');
        if (!badge) return;
        badge.addEventListener('click', function(e){
          e.preventDefault();
          try { if (typeof window.hg === 'function') window.hg('open'); } catch(_) {}
        });
      })();
    </script>

    <!-- Click-away to close HelpGenie -->
    <script>
      (function(){
        function whenHgReady(cb, tries){
          tries = tries || 0;
          if (typeof window.hg === 'function') return cb();
          if (tries > 60) return; // ~6s max wait
          setTimeout(function(){ whenHgReady(cb, tries + 1); }, 100);
        }

        var isOpen = false;
        function isInWidgetPath(e){
          try {
            var path = (typeof e.composedPath === 'function') ? e.composedPath() : [];
            var widgets = Array.prototype.slice.call(document.querySelectorAll(
              'iframe[src*="helpgenie.ai"], [id*="helpgenie"], [class*="helpgenie"], [data-hg], [data-helpgenie]'
            ));
            for (var i = 0; i < path.length; i++) {
              var node = path[i];
              if (!node || node.nodeType !== 1) continue;
              for (var j = 0; j < widgets.length; j++) {
                var w = widgets[j];
                if (w === node || (typeof w.contains === 'function' && w.contains(node))) return true;
              }
            }
          } catch(_) {}
          return false;
        }

        function onPointerDown(e){
          if (!isOpen) return;
          if (isInWidgetPath(e)) return;
          try { window.hg('close'); } catch(_) {}
        }

        function attach(){ document.addEventListener('pointerdown', onPointerDown, true); }
        function detach(){ document.removeEventListener('pointerdown', onPointerDown, true); }

        whenHgReady(function(){
          var wired = false;
          try {
            window.hg('on', 'open', function(){ isOpen = true; if (!wired) { attach(); wired = true; } });
            window.hg('on', 'close', function(){ isOpen = false; });
          } catch(e) {
            // Fallback: poll visibility to toggle isOpen
            setInterval(function(){
              try {
                var el = document.querySelector('iframe[src*="helpgenie.ai"], [id*="helpgenie"], [class*="helpgenie"], [data-hg], [data-helpgenie]');
                var opened = false;
                if (el) {
                  var rect = el.getBoundingClientRect();
                  var st = window.getComputedStyle(el);
                  var vis = st && st.display !== 'none' && st.visibility !== 'hidden' && parseFloat(st.opacity || '1') > 0.05;
                  opened = vis && rect.width > 200 && rect.height > 200;
                }
                if (opened && !isOpen) { isOpen = true; if (!wired) { attach(); wired = true; } }
                if (!opened && isOpen) { isOpen = false; }
              } catch(_) {}
            }, 900);
          }
        });
      })();
    </script>
    <script src="https://enterprisedna.co/widget/ecosystem-widget.js" data-button-color="#6654f5"></script>
</body>
</html>